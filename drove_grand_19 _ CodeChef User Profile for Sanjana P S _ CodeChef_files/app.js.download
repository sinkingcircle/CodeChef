$(document).ready(function(){if(!Ember.isEmpty(Drupal.settings.username)){Ember.$.ajaxSetup({beforeSend:function(e){e.setRequestHeader("x-csrf-token",window.csrfToken)}});App=Ember.Application.createWithMixins(Bootstrap,{LOG_TRANSITIONS:true,LOG_VIEW_LOOKUPS:true,rootElement:"#ember_root"});App.Router.map(function(){this.resource("sets",{path:"/"})});App.Set=DS.Model.extend({set_name:DS.attr("string"),description:DS.attr("string"),members:DS.hasMany("member"),membersCount:function(){try{if(Ember.isEmpty(this.get("members"))){return 0}return this.get("members.length")}catch(e){return 0}}.property("members","members.length"),isAdded:function(){var e=Drupal.settings.currentUser;var t=false;try{this.get("members").forEach(function(r){if(r.get("member_name")==e){t=true}})}catch(e){return t}return t}.property("members.length","set_name")});App.Member=DS.Model.extend({member_uid:DS.attr("number"),set_id:DS.belongsTo("set"),member_name:DS.attr("string"),long_contest_rating:DS.attr("number"),short_contest_rating:DS.attr("number"),country_code:DS.attr("string"),profile_link:function(){return"https://www.codechef.com/users/"+this.get("member_name")}.property("member_name"),flag_url:function(){var e=this.get("country_code");return"https://cdn.codechef.com/download/flags/24/"+e+".png"}.property("country_code")});App.MemberAdapter=DS.RESTAdapter.extend({namespace:"api/sets"});App.SetAdapter=DS.RESTAdapter.extend({namespace:"api"});App.SetsController=Ember.ArrayController.extend({init:function(){this._super();this.set("currentUser",Drupal.settings.currentUser);this.send("fetchSets")},error:false,actions:{fetchSets:function(){var e=this;this.store.find("set").then(function(t){e.set("model",t);e.set("error",false)},function(t){e.showError(t);e.set("error",true)})},deleteMember:function(e){var t=this.get("currentUser");var r=e.get("members");var n=false;var o=this;r.forEach(function(r){if(r.get("member_name")==t){n=true;r.destroyRecord().then(function(t){o.showMemberDeletedMessage(t.get("member_name"),e.get("set_name"))},function(t){r.rollback();e.get("members").pushObject(r);o.showError(t)})}});if(!n){s(t+" not in set "+e.get("set_name"))}},addMember:function(e){var t=this.get("currentUser");var r=e.get("set_name");var s=this;if(!this.isValidMemberDetails(t,e)){return}var n=this.store.createRecord("member",{set_id:e,member_name:t});n.save().then(function(e){s.showMemberAddedMessage(t,r)},function(e){n.deleteRecord();s.showError(e)})}},isValidMemberDetails:function(e,t){if(t.get("membersCount")>=Drupal.settings.maxSetMembersCount){this.showErrorMessage("Oops! you've reached your member addition limit of "+Drupal.settings.maxSetMembersCount+" members.");return false}if(this.isMemberInSet(e,t)){this.showDuplicateMemberMessage(e,t.get("set_name"));return false}return true},isMemberInSet:function(e,t){return!Ember.isEmpty(t.get("members").filterBy("member_name",e))},showMemberAddedMessage:function(e,r){t("You've added "+e+" to set "+r+". Thatâ€™s a good union.")},showDuplicateMemberMessage:function(e,t){r("You already have "+e+" in set "+t+". A set can only have unique members.")},showMemberDeletedMessage:function(t,r){e("You've deleted "+t+" from your set "+r+". Seemed a good chap to us.")},showErrorMessage:function(e){s(e)},showError:function(e){var t=e.status==422?jQuery.parseJSON(e.responseText).error:"Couldn't complete the request please try again.";s(t)}});App.BoxView=Ember.View.extend({didInsertElement:function(){this._super();var e=this;this.$().hide();this.get("parentView").reopen({mouseEnter:function(t){e.$().fadeIn(300)},mouseLeave:function(t){e.$().fadeOut(300)}})}});function e(e){Bootstrap.GNM.push("INFO!",e,"info")}function t(e){Bootstrap.GNM.push("SUCCESS!",e,"success")}function r(e){Bootstrap.GNM.push("WARN!",e,"warning")}function s(e){Bootstrap.GNM.push("Error!",e,"danger")}}});